import*as Storage from"@storage";import*as Env from"@env";window.storage=Storage.open(Env.path("USER_DOCUMENTS")+"/data.db");var root=storage.root||initDb(storage);function initDb(e){return e.root={version:1,meta:{},localStorage:{},sessionStorage:{},cookie:{}},e.commit(),e.root}window.localStorage={setItem:function(e,t){root.localStorage[e]=t,storage.commit()},getItem:function(e){return root.localStorage[e]?root.localStorage[e]:""},removeItem:function(e){this.setItem(e,void 0)},clear:function(){root.localStorage={},storage.commit()}},window.sessionStorage={setItem:function(e,t){root.sessionStorage[e]=t},getItem:function(e){return root.sessionStorage[e]?root.sessionStorage[e]:""},removeItem:function(e){this.setItem(e,void 0)},clear:function(){root.sessionStorage={}}},String.prototype.toBoolean=function(){return!!/^\s*(true|1|on|yes)\s*$/i.test(this)||!/^\s*(false|0|off|no)\s*$/i.test(this)&&Boolean(this)},Object.defineProperty(document,"cookie",{get:function(){var e=new Map([[".",""],["",""],["none",""],["None",""],["undefined",""],["Undefined",""],["null",""],["Null",""],[void 0,""],[null,""]]),t=location.host,o=location.pathname;if(e.has(t))t="localhost";var r=t.split("."),i=o.split("/");r=p(r),i=p(i);location.host||i.shift();for(var n="",a=".",s=0,l={},f=r.length,c=f-1;c>-1;c--){if(++s<=1)var g=1;if(1==f)g=0;var u=r[c].replace(/\s*/g,"");if(u){n=u+n;if(g||v(n),s==f)a="";n=a+n,g=0}}function v(e){for(var t=storage.root.cookie[e],o=t,r=i.length,n=0;n<=r&&(n!=r||!n);n++){if(n==r&&!n)var a=1;if(!o)break;for(var s in t=o)if(t[s].key){var f=new Date>t[s].expires.getTime();f&&delete t[s],f||(l[t[s].key]=t[s].value),f||l[t[s].key]||(l[t[s].key]="")}a||(o=t["@"+i[n]])}}function p(e){for(var t=0;t<e.length;t++){if(o=e[t])var o=o.replace(/\s*/g,"");o||e.splice(t,1),o||t--}return e}var m="",h="; ",d=(s=0,Object.keys(l).length);for(var c in l){if(++s==d)h="";m+=c+"="+l[c]+h}return m},set:function(e){for(var t=new Map([[".",""],["",""],["none",""],["None",""],["undefined",""],["Undefined",""],["null",""],["Null",""],[void 0,""],[null,""]]),o=e.split(";"),r=["key","value"],i=0,n={},a=0;a<o.length;a++){if(i<=1)var s=1;if((h=o[a].trim())||i++,h){var l=h.split("=");s&&(l[1]=l[i]),s&&(l[0]=r[i]),"expires"==l[0]&&(l[1]=new Date(l[1])),"secure"==l[0]&&null==l[1]&&(l[1]="1"),"secure"==l[0]&&(l[1]=l[1].toBoolean()),n[l[0]]=l[1];s=0;i<=0&&a--,i++}}if(n.value||(n.value=""),!n.expires)var f=new Date;if(!n.expires)var c=f.getDate()+7;if(!n.expires)var g=new Date;n.expires||g.setDate(c),n.expires||(n.expires=g),t.has(n.domain)&&(n.domain="localhost");var u=n.domain.split("."),v="",p=".",m=(i=0,storage.root.cookie);for(a=(u=k(u)).length-1;a>-1;a--){if(++i<=1)s=1;var h=u[a].replace(/\s*/g,"");if(1==u.length)s=0;if(h){v=h+v;if(s||m[v]||(m[v]={}),i==u.length)p="";v=p+v,s=0}}t.has(n.path)&&(n.path="/");var d=n.path.split("/"),S="";for(i=0,m=m[v],d=k(d),a=0;a<d.length;a++){i++,(h=d[a].trim())&&(m[h]||(m["@"+h]={}),m=m["@"+h],S+="/"+h)}function k(e){for(var t=0;t<e.length;t++){if(o=e[t])var o=o.replace(/\s*/g,"");o||e.splice(t,1),o||t--}return e}S||(S="/"),n.domain=v,n.path=S,m[n.key]=n,storage.commit()}}),window.Cookies={set:function(e,t,o){if(!e)return"";if(!t)t="";if(!o)o={};o.path||(o.path="/"),o.expires||(o.expires=7);var r=new Date;r.setTime(r.getTime()+24*o.expires*60*60*1e3);var i=r.toUTCString(),n=e+"="+t+"; ",a="; ",s=Object.keys(o).length,l=0;for(var f in o){if(++l==s)a="";"expires"!=f&&(o[f]=o[f].toString()),"expires"==f&&(o[f]=i),n+=f+"="+o[f]+a}return document.cookie=n,n},get:function(e){for(var t=e+"=",o=document.cookie.split(";"),r={},i=0;i<o.length;i++){var n=o[i].trim();if(!e)var a=n.split("=");if(e||(r[a[0]]=a[1]),0==n.indexOf(t))return n.substring(t.length,n.length)}return e?"":r},remove:function(e,t){if(!t)t={};return t.expires=0,this.set(e,"",t)}};